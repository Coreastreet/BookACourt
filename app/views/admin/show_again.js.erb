
// if the session of bookin exist?
<% if session[:bookings] %>
var bookings = <%= raw session[:bookings] %>;

// newly selected date value
var newDate = document.querySelector('#my_hidden_input').value;
var arr = newDate.split('/');
var formattedDate = `${arr[2]}-${arr[0]}-${arr[1]}`
// reverse format
var i = 0;
var j = 0;
var booking_start;
var booking_end;
var columnArray;
var nextColumnArray;
var booked = false;
var columnNumber;
var booking;
var table = document.querySelector('table.table-sm');
clearTable(table);
while (i < bookings.length) {
  if (bookings[i].date === formattedDate) {
    booking = bookings[i];
    j = 0;
    booking_start = booking.startTime.substr(11,5);
    booking_end = booking.endTime.substr(11,5);
    console.log("start", booking_start);
    console.log("end", booking_end);
    columnArray = document.querySelectorAll(`[data-court="${booking.court_no}"]`);
    if (booking.courtType == "halfCourt") {
          while (j < columnArray.length) {
            if (columnArray[j].dataset.time == booking_start) {
              booked = true;
            }
            if (columnArray[j].dataset.time == booking_end) {
              booked = false;
            }
            if (booked) {
              columnArray[j].classList.add("table-active");
            }
            j++;
          }
     } else if (booking.courtType == "fullCourt") {
         nextColumnArray = document.querySelectorAll(`[data-court="${booking.court_no + 1}"]`);
         while (j < columnArray.length) {
           if (columnArray[j].dataset.time == booking_start) {
             booked = true;
           }
           if (columnArray[j].dataset.time == booking_end) {
             booked = false;
           }
           if (booked) {
             columnArray[j].classList.add("table-primary");
             nextColumnArray[j].classList.add("table-primary");
           }
           j++;
         }
     }
  }
  i++;
}
<% end %>
//var bookings = JSON.parse(bookings_json);

function clearTable(table) {
  var bookedTimes = table.querySelectorAll('.table-active');
  var i = 0;
  while (i < bookedTimes.length) {
    bookedTimes[i].classList.remove('table-active');
    i++;
  }

  var bookedFullTimes = table.querySelectorAll('.table-primary');
  var j = 0;
  while (j < bookedFullTimes.length) {
    bookedFullTimes[j].classList.remove('table-primary');
    j++;
  }
}
